---
/**
 * Homepage
 *
 * Data Sources:
 * - CMS: case-studies, clients, testimonials, blog, categories, team-members, industries
 * - JSON: faq-items.json (via content layer)
 *
 * Components: Header, Hero, Partners, CaseStudySlider, Audit, Results,
 *             Marketing, Approach, Knowledge, FAQ, CTA, Footer
 */
import Layout from '../layouts/Layout.astro';
import FAQ from '../components/ui/FAQ.astro';
import Knowledge from '../components/ui/Knowledge.astro';
import Approach from '../components/ui/Approach.astro';
import Results from '../components/ui/Results.astro';
import Audit from '../components/ui/Audit.astro';
import CaseStudySlider from '../components/ui/CaseStudySlider.astro';
import Hero from '../components/ui/Hero.astro';
import Partners from '../components/ui/Partners.astro';
import Marketing from '../components/ui/Marketing.astro';
import CTA from '../components/ui/CTA.astro';
import Footer from '../components/ui/Footer.astro';
import Header from '../components/ui/Header.astro';
import { getFAQItemsContent } from '../lib/content-utils';
import { fetchHomepageData, getAccessToken, getEmptyHomepageData } from '../lib/cms-data';
import { asset } from '../lib/assets';

// FAQ items loaded from JSON content layer
const faqItems = getFAQItemsContent().items;

// CMS Data Fetching - consolidated into cms-data.ts
const accessToken = getAccessToken(Astro.locals);
const cmsData = accessToken
  ? await fetchHomepageData(accessToken)
  : getEmptyHomepageData();

// Destructure for easier template access
const {
  caseStudies,
  clients,
  allClients,
  testimonials,
  allTestimonials,
  blogPosts,
  categories,
  teamMembers,
  industries,
} = cmsData;
---
<Layout>
  <div class="page-wrapper">
    <!-- Header Navigation -->
    <Header />
    <!-- Cal.com popup embed script -->
    <script type="text/javascript" is:inline>
      (function (C, A, L) { let p = function (a, ar) { a.q.push(ar); }; let d = C.document; C.Cal = C.Cal || function () { let cal = C.Cal; let ar = arguments; if (!cal.loaded) { cal.ns = {}; cal.q = cal.q || []; d.head.appendChild(d.createElement("script")).src = A; cal.loaded = true; } if (ar[0] === L) { const api = function () { p(api, arguments); }; const namespace = ar[1]; api.q = api.q || []; if(typeof namespace === "string"){cal.ns[namespace] = cal.ns[namespace] || api;p(cal.ns[namespace], ar);p(cal, ["initNamespace", namespace]);} else p(cal, ar); return;} p(cal, ar); }; })(window, "https://app.cal.com/embed/embed.js", "init");
      Cal("init", {origin:"https://app.cal.com"});
      Cal("ui", {"hideEventTypeDetails":false,"layout":"month_view"});
    </script>
    <main id="main-content" class="main-wrapper">
      <!-- Hero Section -->
      <Hero caseStudies={caseStudies} clients={clients} industries={industries} />

      <!-- Partners Section -->
      <Partners testimonials={allTestimonials} clients={allClients} />
      <!-- Case Study Slider Section -->
      <CaseStudySlider
        caseStudies={caseStudies}
        clients={clients}
        industries={industries}
        testimonials={testimonials}
      />
      <!-- Audit Section -->
      <Audit />
      <!-- Results Section (Bento Grid) -->
      <Results
        caseStudies={caseStudies.slice(0, 2)}
        testimonial={allTestimonials[0]}
        clients={clients}
      />
      <!-- Marketing Section -->
      <Marketing />
      <!-- Approach Section (Process + Stats) -->
      <Approach />
      <!-- Knowledge/Blog Section -->
      <Knowledge
        posts={blogPosts}
        categories={Array.from(categories.values())}
        authors={Array.from(teamMembers.values())}
      />
      <!-- FAQ Section -->
      <FAQ items={faqItems} />
      <!-- CTA Section -->
      <CTA />
    </main>
    <!-- Footer -->
    <Footer caseStudies={caseStudies} blogPosts={blogPosts} />
    <!-- Webflow Enterprise Partner Badge -->
    <a
      href="https://webflow.com/@loudface"
      target="_blank"
      rel="noopener noreferrer"
      class="fixed bottom-6 right-6 z-50 transition-opacity hover:opacity-80"
      aria-label="Webflow Enterprise Partner"
    >
      <img
        loading="lazy"
        src={asset('/images/Enterprise-Blue-Badge.webp')}
        alt="Webflow Enterprise Partner Badge"
        class="w-24 h-auto drop-shadow-lg"
      />
    </a>
  </div>
</Layout>
