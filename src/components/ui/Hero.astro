---
import { applyCMSConfig } from '../../lib/cms-utils';
import { generateCMSAttributes } from '../../lib/cms-attributes';
import { CMS_SECTIONS } from '../../lib/constants';
import type { CaseStudy, Client, Industry } from '../../lib/types';
import { getHeroContent } from '../../lib/content-utils';
import { AI_PLATFORM_ICONS, AI_PLATFORM_LINKS } from '../../lib/icons';
import { asset } from '../../lib/assets';
import Button from './Button.astro';

// Load content from JSON file (editable via /dev/editor)
const content = getHeroContent();

interface Props {
  headline?: string;
  description?: string;
  ctaText?: string;
  caseStudies: CaseStudy[];
  clients?: Map<string, Client>;
  industries?: Map<string, Industry>;
}

// Props can still override JSON defaults
const {
  headline = content.headline,
  description = content.description,
  ctaText = content.ctaText,
  caseStudies: rawCaseStudies,
  clients = new Map(),
  industries = new Map()
} = Astro.props;

const caseStudies = applyCMSConfig(rawCaseStudies, CMS_SECTIONS.HERO_SLIDER, 'case-studies');

const referenceLookups = {
  clients: clients,
  industries: industries,
};

function getClient(clientId: string | undefined): Client | undefined {
  if (!clientId) return undefined;
  return clients.get(clientId);
}

// Build aiLinks array from JSON content + shared icons
const aiLinks = content.aiLinks.map(link => ({
  name: link.name,
  url: link.url,
  icon: AI_PLATFORM_ICONS[link.name]?.path || ''
}));
---

<section class="pt-4">
  <div class="px-4 md:px-8 lg:px-12">
    <div class="max-w-7xl mx-auto">
      <!-- Hero Container - Min height allows growth when content overflows -->
      <div class="relative grid grid-cols-1 lg:grid-cols-2 min-h-0 lg:min-h-144 xl:min-h-160 border border-surface-200 bg-surface-50 rounded-2xl overflow-hidden">

        <!-- Left: Content -->
        <div class="flex flex-col justify-center items-center lg:items-start p-6 sm:p-8 md:p-10 lg:p-12 text-center lg:text-left min-w-0">
          <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-hero font-medium text-surface-900 leading-tight" set:html={headline} />
          <p class="mt-4 sm:mt-5 text-base sm:text-lg text-surface-600 leading-relaxed" set:html={description} />

          <!-- AI Platform Links -->
          <div class="flex gap-2 flex-wrap mt-5 justify-center lg:justify-start">
            {aiLinks.map((link) => (
              <a
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center justify-center w-10 h-10 rounded-lg border border-surface-200 bg-white text-surface-600 hover:border-primary-300 hover:bg-primary-50 hover:text-primary-600 transition-all focus-visible:outline-2 focus-visible:outline-primary-500 focus-visible:outline-offset-2"
                aria-label={`Ask ${link.name} about LoudFace`}
              >
                <svg class="w-5 h-5" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg" set:html={link.icon} />
              </a>
            ))}
          </div>

          <!-- CTA Button -->
          <Button variant="primary" size="lg" calLink="arnelbukva/loudface-intro-call" class="mt-5">
            {ctaText}
          </Button>
        </div>

        <!-- Right: Scrolling Case Studies - Hidden on mobile -->
        <div
          class="hidden md:block relative h-96 lg:h-144 xl:h-160 overflow-hidden lg:rounded-r-2xl"
          data-cms-section={CMS_SECTIONS.HERO_SLIDER}
          data-cms-label="Hero Case Studies"
        >
          <!-- Scrolling Columns Container -->
          <div class="absolute inset-0 flex gap-4 p-4" data-cms-container>
            <!-- Column 1: Scroll Down -->
            <div class="flex-1 flex flex-col gap-4 animate-scroll-down hover:animation-paused">
              {caseStudies.map((study) => {
                const client = getClient(study.client);
                return (
                  <a
                    href={`/work/${study.slug}`}
                    class="flex-shrink-0 flex flex-col bg-white rounded-xl overflow-hidden border border-surface-200 hover:opacity-85 transition-opacity focus-visible:outline-2 focus-visible:outline-primary-500 focus-visible:outline-offset-2"
                    {...generateCMSAttributes(study, 'case-studies', referenceLookups)}
                  >
                    <div class="flex justify-between items-center p-4 gap-2">
                      <div class="flex-1 min-w-0">
                        {client?.['colored-logo']?.url ? (
                          <img
                            src={client['colored-logo'].url}
                            alt={client.name || 'Client logo'}
                            loading="lazy"
                            class="max-h-6 w-auto"
                          />
                        ) : (
                          <span class="font-medium text-surface-700">{client?.name || study.name}</span>
                        )}
                      </div>
                      <span class="flex items-center gap-1 text-sm font-medium text-surface-700 whitespace-nowrap">
                        Read case study
                        <svg class="w-3 h-3" viewBox="0 0 11 10" fill="none">
                          <path d="M2.91854 1.85641H8.14011L1.06819 8.92834C1.01486 8.98166 0.972567 9.04496 0.94371 9.11463C0.914853 9.1843 0.9 9.25897 0.9 9.33437C0.9 9.40978 0.914853 9.48445 0.94371 9.55412C0.972567 9.62379 1.01486 9.68709 1.06818 9.74041C1.12151 9.79373 1.18481 9.83603 1.25448 9.86488C1.32414 9.89374 1.39881 9.90859 1.47422 9.90859C1.54963 9.90859 1.6243 9.89374 1.69396 9.86488C1.76363 9.83603 1.82693 9.79373 1.88025 9.74041L8.95193 2.66873V7.91349C8.95193 8.06562 9.01236 8.21153 9.11994 8.3191C9.22752 8.42668 9.37342 8.48711 9.52555 8.48711C9.67769 8.48711 9.82359 8.42668 9.93116 8.3191C10.0387 8.21153 10.0992 8.06562 10.0992 7.91349V1.31361C10.0997 1.30337 10.1 1.29311 10.1 1.28281C10.1 1.13052 10.0395 0.984466 9.93182 0.876779C9.82413 0.769092 9.67807 0.708594 9.52578 0.708594C9.51717 0.708594 9.50858 0.708787 9.50001 0.709172H2.91854C2.7664 0.709172 2.6205 0.769607 2.51292 0.877182C2.40535 0.984757 2.34491 1.13066 2.34491 1.28279C2.34491 1.43493 2.40535 1.58083 2.51292 1.6884C2.6205 1.79598 2.7664 1.85641 2.91854 1.85641Z" fill="currentColor" stroke="white" stroke-width="0.2"/>
                        </svg>
                      </span>
                    </div>
                    <div class="aspect-[388/250] overflow-hidden">
                      <img
                        src={study['main-project-image-thumbnail']?.url || asset('/images/placeholder.webp')}
                        alt={study['main-project-image-thumbnail']?.alt || study['project-title']}
                        loading="lazy"
                        class="w-full h-full object-cover"
                      />
                    </div>
                    <div class="p-4">
                      <p class="text-2xl font-medium text-surface-900">{study['result-1---number'] || ''}</p>
                      <p class="text-sm text-surface-600 mt-1">{study['result-1---title'] || ''}</p>
                    </div>
                  </a>
                );
              })}
              <!-- Duplicate for seamless loop -->
              {caseStudies.map((study) => {
                const client = getClient(study.client);
                return (
                  <a href={`/work/${study.slug}`} class="flex-shrink-0 flex flex-col bg-white rounded-xl overflow-hidden border border-surface-200 hover:opacity-85 transition-opacity" tabindex="-1" aria-hidden="true">
                    <div class="flex justify-between items-center p-4 gap-2">
                      <div class="flex-1 min-w-0">
                        {client?.['colored-logo']?.url ? (
                          <img src={client['colored-logo'].url} alt="" loading="lazy" class="max-h-6 w-auto" />
                        ) : (
                          <span class="font-medium text-surface-700">{client?.name || study.name}</span>
                        )}
                      </div>
                      <span class="flex items-center gap-1 text-sm font-medium text-surface-700 whitespace-nowrap">
                        Read case study
                        <svg class="w-3 h-3" viewBox="0 0 11 10" fill="none"><path d="M2.91854 1.85641H8.14011L1.06819 8.92834C1.01486 8.98166 0.972567 9.04496 0.94371 9.11463C0.914853 9.1843 0.9 9.25897 0.9 9.33437C0.9 9.40978 0.914853 9.48445 0.94371 9.55412C0.972567 9.62379 1.01486 9.68709 1.06818 9.74041C1.12151 9.79373 1.18481 9.83603 1.25448 9.86488C1.32414 9.89374 1.39881 9.90859 1.47422 9.90859C1.54963 9.90859 1.6243 9.89374 1.69396 9.86488C1.76363 9.83603 1.82693 9.79373 1.88025 9.74041L8.95193 2.66873V7.91349C8.95193 8.06562 9.01236 8.21153 9.11994 8.3191C9.22752 8.42668 9.37342 8.48711 9.52555 8.48711C9.67769 8.48711 9.82359 8.42668 9.93116 8.3191C10.0387 8.21153 10.0992 8.06562 10.0992 7.91349V1.31361C10.0997 1.30337 10.1 1.29311 10.1 1.28281C10.1 1.13052 10.0395 0.984466 9.93182 0.876779C9.82413 0.769092 9.67807 0.708594 9.52578 0.708594C9.51717 0.708594 9.50858 0.708787 9.50001 0.709172H2.91854C2.7664 0.709172 2.6205 0.769607 2.51292 0.877182C2.40535 0.984757 2.34491 1.13066 2.34491 1.28279C2.34491 1.43493 2.40535 1.58083 2.51292 1.6884C2.6205 1.79598 2.7664 1.85641 2.91854 1.85641Z" fill="currentColor" stroke="white" stroke-width="0.2"/></svg>
                      </span>
                    </div>
                    <div class="aspect-[388/250] overflow-hidden">
                      <img src={study['main-project-image-thumbnail']?.url || asset('/images/placeholder.webp')} alt="" loading="lazy" class="w-full h-full object-cover" />
                    </div>
                    <div class="p-4">
                      <p class="text-2xl font-medium text-surface-900">{study['result-1---number'] || ''}</p>
                      <p class="text-sm text-surface-600 mt-1">{study['result-1---title'] || ''}</p>
                    </div>
                  </a>
                );
              })}
            </div>

            <!-- Column 2: Scroll Up (hidden below xl) -->
            <div class="hidden xl:flex flex-1 flex-col gap-4 animate-scroll-up hover:animation-paused">
              {[...caseStudies].reverse().map((study) => {
                const client = getClient(study.client);
                return (
                  <a href={`/work/${study.slug}`} class="flex-shrink-0 flex flex-col bg-white rounded-xl overflow-hidden border border-surface-200 hover:opacity-85 transition-opacity focus-visible:outline-2 focus-visible:outline-primary-500 focus-visible:outline-offset-2">
                    <div class="flex justify-between items-center p-4 gap-2">
                      <div class="flex-1 min-w-0">
                        {client?.['colored-logo']?.url ? (
                          <img src={client['colored-logo'].url} alt={client.name || 'Client logo'} loading="lazy" class="max-h-6 w-auto" />
                        ) : (
                          <span class="font-medium text-surface-700">{client?.name || study.name}</span>
                        )}
                      </div>
                      <span class="flex items-center gap-1 text-sm font-medium text-surface-700 whitespace-nowrap">
                        Read case study
                        <svg class="w-3 h-3" viewBox="0 0 11 10" fill="none"><path d="M2.91854 1.85641H8.14011L1.06819 8.92834C1.01486 8.98166 0.972567 9.04496 0.94371 9.11463C0.914853 9.1843 0.9 9.25897 0.9 9.33437C0.9 9.40978 0.914853 9.48445 0.94371 9.55412C0.972567 9.62379 1.01486 9.68709 1.06818 9.74041C1.12151 9.79373 1.18481 9.83603 1.25448 9.86488C1.32414 9.89374 1.39881 9.90859 1.47422 9.90859C1.54963 9.90859 1.6243 9.89374 1.69396 9.86488C1.76363 9.83603 1.82693 9.79373 1.88025 9.74041L8.95193 2.66873V7.91349C8.95193 8.06562 9.01236 8.21153 9.11994 8.3191C9.22752 8.42668 9.37342 8.48711 9.52555 8.48711C9.67769 8.48711 9.82359 8.42668 9.93116 8.3191C10.0387 8.21153 10.0992 8.06562 10.0992 7.91349V1.31361C10.0997 1.30337 10.1 1.29311 10.1 1.28281C10.1 1.13052 10.0395 0.984466 9.93182 0.876779C9.82413 0.769092 9.67807 0.708594 9.52578 0.708594C9.51717 0.708594 9.50858 0.708787 9.50001 0.709172H2.91854C2.7664 0.709172 2.6205 0.769607 2.51292 0.877182C2.40535 0.984757 2.34491 1.13066 2.34491 1.28279C2.34491 1.43493 2.40535 1.58083 2.51292 1.6884C2.6205 1.79598 2.7664 1.85641 2.91854 1.85641Z" fill="currentColor" stroke="white" stroke-width="0.2"/></svg>
                      </span>
                    </div>
                    <div class="aspect-[388/250] overflow-hidden">
                      <img src={study['main-project-image-thumbnail']?.url || asset('/images/placeholder.webp')} alt={study['main-project-image-thumbnail']?.alt || study['project-title']} loading="lazy" class="w-full h-full object-cover" />
                    </div>
                    <div class="p-4">
                      <p class="text-2xl font-medium text-surface-900">{study['result-1---number'] || ''}</p>
                      <p class="text-sm text-surface-600 mt-1">{study['result-1---title'] || ''}</p>
                    </div>
                  </a>
                );
              })}
              <!-- Duplicate for seamless loop -->
              {[...caseStudies].reverse().map((study) => {
                const client = getClient(study.client);
                return (
                  <a href={`/work/${study.slug}`} class="flex-shrink-0 flex flex-col bg-white rounded-xl overflow-hidden border border-surface-200 hover:opacity-85 transition-opacity" tabindex="-1" aria-hidden="true">
                    <div class="flex justify-between items-center p-4 gap-2">
                      <div class="flex-1 min-w-0">
                        {client?.['colored-logo']?.url ? (
                          <img src={client['colored-logo'].url} alt="" loading="lazy" class="max-h-6 w-auto" />
                        ) : (
                          <span class="font-medium text-surface-700">{client?.name || study.name}</span>
                        )}
                      </div>
                      <span class="flex items-center gap-1 text-sm font-medium text-surface-700 whitespace-nowrap">
                        Read case study
                        <svg class="w-3 h-3" viewBox="0 0 11 10" fill="none"><path d="M2.91854 1.85641H8.14011L1.06819 8.92834C1.01486 8.98166 0.972567 9.04496 0.94371 9.11463C0.914853 9.1843 0.9 9.25897 0.9 9.33437C0.9 9.40978 0.914853 9.48445 0.94371 9.55412C0.972567 9.62379 1.01486 9.68709 1.06818 9.74041C1.12151 9.79373 1.18481 9.83603 1.25448 9.86488C1.32414 9.89374 1.39881 9.90859 1.47422 9.90859C1.54963 9.90859 1.6243 9.89374 1.69396 9.86488C1.76363 9.83603 1.82693 9.79373 1.88025 9.74041L8.95193 2.66873V7.91349C8.95193 8.06562 9.01236 8.21153 9.11994 8.3191C9.22752 8.42668 9.37342 8.48711 9.52555 8.48711C9.67769 8.48711 9.82359 8.42668 9.93116 8.3191C10.0387 8.21153 10.0992 8.06562 10.0992 7.91349V1.31361C10.0997 1.30337 10.1 1.29311 10.1 1.28281C10.1 1.13052 10.0395 0.984466 9.93182 0.876779C9.82413 0.769092 9.67807 0.708594 9.52578 0.708594C9.51717 0.708594 9.50858 0.708787 9.50001 0.709172H2.91854C2.7664 0.709172 2.6205 0.769607 2.51292 0.877182C2.40535 0.984757 2.34491 1.13066 2.34491 1.28279C2.34491 1.43493 2.40535 1.58083 2.51292 1.6884C2.6205 1.79598 2.7664 1.85641 2.91854 1.85641Z" fill="currentColor" stroke="white" stroke-width="0.2"/></svg>
                      </span>
                    </div>
                    <div class="aspect-[388/250] overflow-hidden">
                      <img src={study['main-project-image-thumbnail']?.url || asset('/images/placeholder.webp')} alt="" loading="lazy" class="w-full h-full object-cover" />
                    </div>
                    <div class="p-4">
                      <p class="text-2xl font-medium text-surface-900">{study['result-1---number'] || ''}</p>
                      <p class="text-sm text-surface-600 mt-1">{study['result-1---title'] || ''}</p>
                    </div>
                  </a>
                );
              })}
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<style>
  /* Scrolling animation keyframes */
  @keyframes scroll-down {
    0% { transform: translateY(0); }
    100% { transform: translateY(-50%); }
  }

  @keyframes scroll-up {
    0% { transform: translateY(-50%); }
    100% { transform: translateY(0); }
  }

  .animate-scroll-down {
    animation: scroll-down 30s linear infinite;
  }

  .animate-scroll-up {
    animation: scroll-up 30s linear infinite;
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .animate-scroll-down,
    .animate-scroll-up {
      animation: none;
    }
  }
</style>
