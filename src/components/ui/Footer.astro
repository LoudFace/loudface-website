---
import NewsletterForm from './NewsletterForm.astro';
import { createCMS } from '../../lib/cms';
import { asset } from '../../lib/assets';
import { getAIPlatformsWithIcons, getSocialLinksWithIcons } from '../../lib/icons';
import type { CaseStudy, BlogPost } from '../../lib/types';

interface Props {
  caseStudies?: CaseStudy[];
  blogPosts?: BlogPost[];
}

const { caseStudies: rawCaseStudies = [], blogPosts: rawBlogPosts = [] } = Astro.props;

// Create CMS helper - auto-generates section IDs
const cms = createCMS('Footer');

// Apply CMS configuration (filters, sorting)
const caseStudySection = cms.section(rawCaseStudies as (CaseStudy & { id: string })[], 'case-studies', 'Footer Case Studies');
const blogSection = cms.section(rawBlogPosts as (BlogPost & { id: string })[], 'blog', 'Footer Blog Posts');

// Navigation data
const companyLinks = [
  { label: 'About us', href: '/about-us' },
  { label: 'Contact', href: '/contact' },
  { label: 'Careers', href: '/careers' }
];

const serviceLinks = [
  { label: 'Webflow Development', href: '/services/webflow-development' },
  { label: 'UX/UI Design', href: '/services/design' },
  { label: 'Copywriting', href: '/services/copywriting' },
  { label: 'SEO/AEO', href: '/services/seo' },
  { label: 'CRO', href: '/services/cro' }
];

const industryLinks = [
  { label: 'SaaS', href: '/industries/saas' },
  { label: 'E-commerce', href: '/industries/ecommerce' },
  { label: 'Education', href: '/industries/education' },
  { label: 'Healthcare', href: '/industries/healthcare' }
];

const resourceLinks = [
  { label: 'Blog', href: '/blog' },
  { label: 'LoudFace Ventures', href: '/ventures' }
];

// AI Platform links - from shared icons module
const aiPlatforms = getAIPlatformsWithIcons();

// Social links - from shared icons module
const socialLinks = getSocialLinksWithIcons();

const currentYear = new Date().getFullYear();
---

<footer class="relative">
  <div class="bg-surface-900 text-white">
    <div class="px-4 md:px-8 lg:px-12">
      <div class="max-w-7xl mx-auto">
        <div class="py-12 md:py-16 lg:py-20">

          <!-- Main Grid: Newsletter + Nav -->
          <div class="grid grid-cols-1 lg:grid-cols-[1fr_2fr] gap-8 sm:gap-10 md:gap-12 lg:gap-16">
            <!-- Newsletter Column -->
            <div class="max-w-xs lg:max-w-none">
              <a href="/" class="inline-block">
                <img
                  src={asset('/images/loudface-inversed.svg')}
                  loading="lazy"
                  width="133"
                  height="26"
                  alt="LoudFace"
                  class="h-6.5 w-auto"
                />
              </a>
              <div class="h-6"></div>
              <p class="text-surface-400 text-sm">
                Join our newsletter to stay up to date on industry news and strategies
              </p>
              <div class="h-6"></div>
              <NewsletterForm />
            </div>

            <!-- Navigation Columns -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-8 gap-y-10">
              <!-- Company -->
              <div class="flex flex-col gap-3">
                <h3 class="text-sm font-semibold text-white mb-1">Company</h3>
                <nav aria-label="Company links">
                  <ul class="flex flex-col gap-2 list-none m-0 p-0">
                    {companyLinks.map(link => (
                      <li><a href={link.href} class="text-sm text-surface-400 hover:text-white transition-colors">{link.label}</a></li>
                    ))}
                  </ul>
                </nav>
              </div>

              <!-- Services -->
              <div class="flex flex-col gap-3">
                <h3 class="text-sm font-semibold text-white mb-1">Services</h3>
                <nav aria-label="Services links">
                  <ul class="flex flex-col gap-2 list-none m-0 p-0">
                    {serviceLinks.map(link => (
                      <li><a href={link.href} class="text-sm text-surface-400 hover:text-white transition-colors">{link.label}</a></li>
                    ))}
                  </ul>
                </nav>
              </div>

              <!-- Industries -->
              <div class="flex flex-col gap-3">
                <h3 class="text-sm font-semibold text-white mb-1">Industries</h3>
                <nav aria-label="Industries links">
                  <ul class="flex flex-col gap-2 list-none m-0 p-0">
                    {industryLinks.map(link => (
                      <li><a href={link.href} class="text-sm text-surface-400 hover:text-white transition-colors">{link.label}</a></li>
                    ))}
                  </ul>
                </nav>
              </div>

              <!-- Resources -->
              <div class="flex flex-col gap-3">
                <h3 class="text-sm font-semibold text-white mb-1">Resources</h3>
                <nav aria-label="Resources links">
                  <ul class="flex flex-col gap-2 list-none m-0 p-0">
                    {resourceLinks.map(link => (
                      <li><a href={link.href} class="text-sm text-surface-400 hover:text-white transition-colors">{link.label}</a></li>
                    ))}
                  </ul>
                </nav>
              </div>

              <!-- Case Studies -->
              {caseStudySection.items.length > 0 && (
                <div
                  class="flex flex-col gap-3 lg:col-span-2"
                  {...caseStudySection.attrs}
                >
                  <h3 class="text-sm font-semibold text-white mb-1">Case Studies</h3>
                  <nav aria-label="Case studies links">
                    <ul class="flex flex-col gap-2 list-none m-0 p-0" data-cms-container>
                    {caseStudySection.items.slice(0, 5).map(study => (
                      <li>
                        <a
                          href={`/work/${study.slug}`}
                          class="block text-sm text-surface-400 hover:text-white transition-colors truncate"
                          title={study['project-title'] || study.name}
                          {...cms.item(study, 'case-studies')}
                        >
                          {study['project-title'] || study.name}
                        </a>
                      </li>
                    ))}
                    </ul>
                  </nav>
                </div>
              )}

              <!-- Articles -->
              {blogSection.items.length > 0 && (
                <div
                  class="flex flex-col gap-3 lg:col-span-2"
                  {...blogSection.attrs}
                >
                  <h3 class="text-sm font-semibold text-white mb-1">Articles</h3>
                  <nav aria-label="Blog articles links">
                    <ul class="flex flex-col gap-2 list-none m-0 p-0" data-cms-container>
                      {blogSection.items.slice(0, 5).map(post => (
                        <li>
                          <a
                            href={`/blog/${post.slug}`}
                            class="block text-sm text-surface-400 hover:text-white transition-colors truncate"
                            title={post.name}
                            {...cms.item(post, 'blog')}
                          >
                            {post.name}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </nav>
                </div>
              )}
            </div>
          </div>

          <!-- Divider -->
          <div class="h-12 md:h-16"></div>
          <div class="h-px bg-surface-700"></div>
          <div class="h-8 md:h-12"></div>

          <!-- Bottom Section: AI + Social -->
          <div class="flex flex-wrap justify-between items-start gap-8">
            <!-- AI Summary -->
            <div>
              <h3 class="text-sm font-medium text-surface-400 mb-3">Explore AI Summary</h3>
              <div class="flex gap-3">
                {aiPlatforms.map(platform => (
                  <a
                    href={platform.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex items-center justify-center w-10 h-10 bg-surface-800 rounded-lg text-surface-400 hover:bg-surface-700 hover:text-white transition-colors"
                    title={platform.name}
                  >
                    <svg class="w-5 h-5" viewBox={platform.icon.viewBox} fill="none" xmlns="http://www.w3.org/2000/svg" set:html={platform.icon.path} />
                  </a>
                ))}
              </div>
            </div>

            <!-- Social Links -->
            <div class="flex gap-4">
              {socialLinks.map(social => (
                <a
                  href={social.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="flex items-center gap-2 text-sm text-surface-400 hover:text-white transition-colors"
                  title={social.name}
                >
                  <span class="w-[1.125rem] h-[1.125rem] [&>svg]:w-full [&>svg]:h-full" set:html={social.icon} />
                  <span class="hidden md:inline">{social.name}</span>
                </a>
              ))}
            </div>
          </div>

          <!-- Divider -->
          <div class="h-8 md:h-12"></div>
          <div class="h-px bg-surface-700"></div>
          <div class="h-6"></div>

          <!-- Copyright -->
          <div class="flex flex-wrap justify-between items-center gap-4">
            <p class="text-surface-500 text-sm">
              &copy; {currentYear} LoudFace. All rights reserved.
            </p>
            <div class="flex gap-6">
              <a href="/privacy" class="text-sm text-surface-500 hover:text-surface-300 transition-colors">Privacy Policy</a>
              <a href="/terms" class="text-sm text-surface-500 hover:text-surface-300 transition-colors">Terms of Service</a>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</footer>
